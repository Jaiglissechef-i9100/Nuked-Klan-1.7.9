
(function (tiny) {
    tiny.PluginManager.requireLangPack("codemagic");
    tiny.PluginManager.add("codemagic", function (editor, url) {
        function showDialog() {
            editor.windowManager.open({
                title: "Insertion de code",
                file: url + "/codemagic.html",
                width: 800,
                height: 530,
                inline: 1,
                resizable: true,
                maximizable: true
            });
        }

        // Add a button that opens a window
        editor.addButton("codemagic", {
            icon: true,
            image: url + "/img/code.png",
            tooltip: "Inserer du code",
            onclick: showDialog,
            onPostRender: function () {
                var self = this;
                editor.on("NodeChange", function (e) {
                    self.active(e.element.nodeName === "IMG");
                });
            }
        });
    });
}(tinymce));