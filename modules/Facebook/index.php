<?php// -------------------------------------------------------------------------//// Nuked-KlaN - PHP Portal                                                  //// http://www.nuked-klan.org                                                //// -------------------------------------------------------------------------//// This program is free software. you can redistribute it and/or modify     //// it under the terms of the GNU General Public License as published by     //// the Free Software Foundation; either version 2 of the License.           //// -------------------------------------------------------------------------//defined('INDEX_CHECK') or die ('You can\'t run this file alone.');if (!function_exists('curl_init')) {  throw new Exception('Facebook needs the CURL PHP extension.');}global $nuked, $language, $user, $bgcolor1, $bgcolor2, $bgcolor3, $bgcolor4;translate("modules/Facebook/lang/" . $language . ".lang.php");$visiteur = $user ? $user[1] : 0;$ModName = basename(dirname(__FILE__));$level_access = nivo_mod($ModName);		// ID de la page à afficher							$sql = mysql_query("SELECT id_facebook FROM " . $nuked['prefix'] . "_facebook WHERE id = '1'");		list($id_facebook) = mysql_fetch_array($sql);				$wallID = $id_facebook;		 /** Retourne le contenu du mur d'une page Facebook.  * @param (string) $wallID : Identifiant de la page.  * @param (int) $maxEntries : Nombre maximum de publications à afficher. */function getFacebookWall($wallID, $maxEntries = 10){	$facebookWall	= null;	$cptEntries		= 1;	$url			= 'http://www.facebook.com/feeds/page.php?id='.$wallID.'&format=atom10';	$userAgent		= 'Mozilla/5.0 (Windows; U; Windows NT 6.1; fr; rv:1.9.2.3) Gecko/20100401 Firefox/3.6.3';	// Initialisation de cURL.	$cURL	= curl_init();	// Définition des options de cURL.	curl_setopt($cURL, CURLOPT_USERAGENT, $userAgent);	curl_setopt($cURL, CURLOPT_URL, $url);			curl_setopt($cURL, CURLOPT_FAILONERROR, true);	curl_setopt($cURL, CURLOPT_FOLLOWLOCATION, false);	curl_setopt($cURL, CURLOPT_AUTOREFERER, true);	curl_setopt($cURL, CURLOPT_RETURNTRANSFER,true);	curl_setopt($cURL, CURLOPT_VERBOSE, false);	curl_setopt($cURL, CURLOPT_RETURNTRANSFER, 1);	// Récupération des données.	$page		= curl_exec($cURL);	$contents	= new SimpleXMLElement($page);		// Fermeture de la connexion.	curl_close($cURL);	// Parcours du contenu du mur.	foreach( $contents->entry as $wall )	{		if ( $cptEntries > $maxEntries ) return $facebookWall;		// Date de la publication.		$date		= date('d/m/Y h:i', strtotime($wall->published));		/* Photo de profil du posteur.		 * Il est possible de changer la taille de l'image en modifiant le paramètre "type".		 * Il prend les valeurs suivantes : small, normal, large, square */		$picture	= 'https://graph.facebook.com/'.$wallID.'/picture?type=normal';		// Affichage.						$facebookWall		.= '<table style="background:transparent url(modules/Facebook/images/title.png) no-repeat top left; border-radius: 10px 10px 0 0; -moz-border-radius: 10px 10px 0 0; -webkit-border-radius: 10px 10px 0 0;" align="center" width="96%" border="0" cellspacing="0" cellpadding="0">';			$facebookWall		.= '<tr style="height: 27px;"><td align="center" style="color: #000;">&nbsp;</td></tr></table>';			$facebookWall		.= '<table style="margin-left:auto; margin-right:auto; border: 1px solid ' . $bgcolor4 . '; border-left: 0px; border-right: 0px; background: #c3c3c3;" width="96%" align="center" cellspacing="0" cellpadding="0">';			$facebookWall		.= '<tr><td style="color: #000;">';			$facebookWall		.= '<div class="facebookWallEntry">';			//$facebookWall		.= '<img src="' . $picture . '" />';				$facebookWall		.= '<br />';					$facebookWall		.= '<div style="text-align: center;"><strong>'.$wall->author->name.'</strong></div>';			$facebookWall		.= '<br />';			$facebookWall		.= '<br />';			$facebookWall		.= '<div style="clear: both; padding-left: 15px; padding-right: 15px;">' .$wall->content . '</div>';			$facebookWall		.= '<br />';			$facebookWall		.= '<div style="text-align: right; padding-left: 15px; padding-right: 15px;"><small>' . _POSTED . ': <i>' . $date . '</i></small></div>';			$facebookWall		.= '<br />';			$facebookWall		.= '<div style="text-align: center;">[ <a href="'.$wall->link->attributes()->href.'" title="'. _SEEFACEBOOK.'" target="_blank">'._SEEFACEBOOK.'</a> ]</div>';			$facebookWall		.= '</div>';			$facebookWall		.= '<div style="clear: both;"></div>';			$facebookWall		.= '<br />';						$facebookWall		.= '</td></tr></table>';			$facebookWall		.= '<table style="background:transparent url(modules/Facebook/images/title_bas.jpg) no-repeat top left; border-radius: 0 0 10px 10px; -moz-border-radius: 0 0 10px 10px; -webkit-border-radius: 0 0 10px 10px;" align="center" width="96%" border="0" cellspacing="0" cellpadding="0">';			$facebookWall		.= '<tr style="height: 27px;"><td align="center" style="color: #000;">&nbsp;</td></tr></table>';			$facebookWall		.= '<br />';						$facebookWall		.= '<br />';								$cptEntries++;	}	return $facebookWall;} if ($visiteur >= $level_access && $level_access > -1){	 	opentable();				echo"	<br />\n"				. "<table style=\"background:transparent url(modules/Facebook/images/title.png) no-repeat top left; border-radius: 10px 10px 10px 10px; -moz-border-radius: 10px 10px 10px 10px; -webkit-border-radius: 10px 10px 10px 10px;\" align=\"center\" width=\"83%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\n"				. "	<tr style=\"height: 27px;\">\n"				. "		<td align=\"center\" style=\"color: #000;\"><big><b>" . _FACEBOOKPAGE . "</b></big></td>\n"				. "	</tr>\n"				. "</table><br /><br />\n";														$echo = (getFacebookWall($wallID, 10));												echo utf8_decode($echo);								echo"		<br />\n";					closetable();			} else if ($level_access == -1){    opentable();    echo '<br /><br /><div style="text-align: center;">' . _MODULEOFF . '<br /><br /><a href="javascript:history.back()"><b>' . _BACK . '</b></a><br /><br /></div>';    closetable();} else if ($level_access == 1 && $visiteur == 0){    opentable();    echo '<br /><br /><div style="text-align: center;">' . _USERENTRANCE . '<br /><br /><b><a href="index.php?file=User&amp;op=login_screen">' . _LOGINUSER . '</a> | <a href="index.php?file=User&amp;op=reg_screen">' . _REGISTERUSER . '</a></b><br /><br /></div>';    closetable();} else{    opentable();    echo '<br /><br /><div style="text-align: center;">' . _NOENTRANCE . '<br /><br /><a href="javascript:history.back()"><b>' . _BACK . '</b></a><br /><br /></div>';    closetable();} ?>